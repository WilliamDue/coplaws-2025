\documentclass[aspectratio=169]{beamer}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{bbm}
\usepackage{listings}
\usepackage{multicol}
\usepackage{csquotes}
\usepackage{biblatex}
\usepackage{hyperref}
\usepackage{indentfirst}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{tikz}
\usepackage{array}
\usepackage{booktabs}

\newcommand{\id}[1]{\ensuremath{\mathit{#1}}}
\newcommand{\kw}[1]{\ensuremath{\mathtt{#1}}}
\newcommand{\Let}{\kw{let}}
\newcommand{\In}{\kw{in}}
\newcommand{\If}{\kw{if}}
\newcommand{\Then}{\kw{then}}
\newcommand{\Else}{\kw{else}}
\newcommand{\Filter}{\kw{filter}}
\newcommand{\Or}{\kw{or}}
\newcommand{\Groupby}{\kw{groupby}}
\newcommand{\Partition}{\kw{partition}}
\newcommand{\Scatter}{\kw{scatter}}
\newcommand{\Hist}{\kw{hist}}
\newcommand{\Map}{\kw{map}}
\newcommand{\Sum}{\kw{sum}}
\newcommand{\Mod}{\kw{mod}}
\newcommand{\Fst}{\kw{fst}}
\newcommand{\Snd}{\kw{snd}}
\newcommand{\Presum}{\kw{presum}}
\newcommand{\True}{\kw{true}}
\newcommand{\False}{\kw{false}}
\newcommand{\Sort}{\kw{sort}}
\newcommand{\Segor}{\kw{segor}}
\newcommand{\Hash}{\kw{hash}}
\newcommand{\Random}{\kw{random}}
\newcommand{\Iota}{\kw{iota}}
\newcommand{\Unzip}{\kw{unzip}}
\newcommand{\Unit}{\mathbf{unit}}
\newcommand{\Int}{\mathbf{int}}
\newcommand{\Bool}{\mathbf{bool}}
\newcommand{\Def}{\kw{def}}
\newcommand{\Rep}{\kw{rep}}
\newcommand{\Zip}{\kw{zip}}

\usetikzlibrary{automata, positioning, arrows}

\graphicspath{ {./figures/} }

\definecolor{palepurple}{rgb}{0.7647,0.69411,0.88235}


\newcolumntype{M}[2]{>{\centering\arraybackslash}m{#1}<{\rule{0pt}{#2}}}
\newcommand{\darkpalepurple}{palepurple!70!black}

\definecolor{paleyellow}{rgb}{1.0,1.0,0.7725}
\setbeamercolor{background canvas}{bg=paleyellow}

\usetheme{default}
\usecolortheme{wolverine}
\setbeamercolor*{palette primary}{bg=palepurple}
\setbeamercolor*{palette quaternary}{bg=palepurple}
\setbeamercolor{structure}{fg=palepurple}
\setbeamertemplate{navigation symbols}{\insertframenumber/\inserttotalframenumber}
\setbeamertemplate{blocks}[rounded][shadow]
\setbeamercolor{frametitle}{bg=midviolet,fg=black}
\setbeamercolor{block title}{bg=structure, fg=black}
\setbeamercolor{block body}{bg=structure, fg=black}
\setbeamercolor{block title alerted}{bg=structure, fg=black}
\setbeamercolor{block body alerted}{bg=structure, fg=black}
\setbeamercolor{block title example}{bg=structure, fg=black}
\setbeamercolor{block body example}{bg=structure, fg=black}
\setbeamercolor{frametitle}{bg=palepurple,fg=black}


\setbeamertemplate{itemize item}{\scriptsize$\blacksquare$}
\setbeamertemplate{itemize subitem}{\scriptsize$\blacksquare$}
\setbeamertemplate{itemize subsubitem}{\scriptsize$\blacksquare$}

\title[Hash Maps]{Functional Hash Maps in a Data Parallel Language}
\author{\textbf{William Henrich Due} \inst{1} \and Martin Elsman \inst{1} \and Troels Henriksen \inst{1}}
\institute[shortinst]{\inst{1} Department of Computer Science, University of Copenhagen}
\date{August 22nd, 2025}

\begin{document}

\begin{frame}
  \begin{center}
    \titlepage
    \vfill
    \usebeamerfont{institute} Contact: \url{widu@di.ku.dk}
  \end{center}
\end{frame}

\begin{frame}\frametitle{Open Adressing Example}
  \begin{columns}
  \begin{column}{.48\textwidth}
  \hfill
  \begin{itemize}
    \item Keys $k_0, k_1 \in K$.
    \item Hash function $h: K \to \{0, 1, 2, 3\}$.
    \item $h(k_0) = h(k_1) = 1$.
  \end{itemize}
  \hfill  
  \end{column}
  \hfill
  \begin{column}{.5\textwidth}
    $$
    \begin{array}{|M{1cm}{0.4cm}|M{1cm}{0.4cm}|M{1cm}{0.4cm}|M{1cm}{0.4cm}|}
      \hline
      & \only<2,4->{$k_0$} \only<3>{$k_0, \color{red}{k_1}$} & \only<4->{$k_1$} & \\ \hline
    \end{array}
    $$
  \end{column}
  \end{columns}
\end{frame}

\begin{frame}\frametitle{Core Ideas}
  \begin{columns}
  \begin{column}{.38\textwidth}
  \hfill
  \begin{itemize}
    \item<1-> Concurrency.
    \item<2-> Collision resolution.
    \item<3-> Functional Array Languages.
  \end{itemize}
  \hfill  
  \end{column}
  \hfill
  \begin{column}{.6\textwidth}
    \onslide<2->{
       $$
    \begin{array}{|M{1cm}{0.4cm}|M{1cm}{0.4cm}|M{1cm}{0.4cm}|M{1cm}{0.4cm}|}
      \hline
      & $k_0$ & $k_1$ & \\ \hline
    \end{array}
    $$
    \begin{center}
      or
    \end{center}
    $$
    \begin{array}{|M{1cm}{0.4cm}|M{1cm}{0.4cm}|M{1cm}{0.4cm}|M{1cm}{0.4cm}|}
      \hline
      & $k_1$ & $k_0$ & \\ \hline
    \end{array}
    $$
    }
    \onslide<3->{
      \begin{align*}
        \Map & : (\alpha \to \beta) \to [n]\alpha \to [n]\beta
      \end{align*}  
    }
  \end{column}
  \end{columns}
\end{frame}

\begin{frame}\frametitle{Perfect Hashing with FKS}
  \begin{columns}
  \begin{column}{.38\textwidth}
  \hfill
  \begin{itemize}
    \item Find a collision-free hash function.
    \item $\{k_0, k_1, k_2\} \subseteq K$.
    \item Pick some $h \in H$ where $H$ is a universal hash family.
    \item<2-> Pick perfect hash functions $h_0, h_1, h_2$ from universal
    hash families.
  \end{itemize}
  \hfill  
  \end{column}
  \hfill
  \begin{column}{.6\textwidth}
    $$
      \begin{array}{|M{1cm}{0.4cm}|M{1cm}{0.4cm}|M{1cm}{0.4cm}|}
      \hline
      $h(k_0)$ & $h(k_1)$ & $h(k_2)$ \\ \hline
      $0$ & $0$ & $1$\\ \hline
      \end{array}
    $$
    \onslide<2->{
      $$
      \begin{array}{|c|M{1cm}{0.4cm}|M{1cm}{0.4cm}|M{1cm}{0.4cm}|}
        \hline
        \text{Bin Size} & 2 & 1 & 0 \\ \hline
        \text{Subhash Map Size} & $2^2$ & $1^2$ & $0^2$ \\ \hline
        \text{Offset ($o_i$)} & 0 & 4 & 5 \\ \hline
        \text{Hash Function} & $h_0$ & $h_1$ & $h_2$ \\ \hline
      \end{array}
      $$
    }
  \end{column}
  \end{columns}
    \onslide<3->{
      $$
      \begin{array}{|M{1.8cm}{0.4cm}|M{1.8cm}{0.4cm}|M{1.8cm}{0.4cm}|M{1.8cm}{0.4cm}||M{1.8cm}{0.4cm}|}
        \hline
        & $o_0 + h_0(k_0)$ & & $o_0 + h_0(k_1)$ & $o_1 + h_1(k_2)$ \\ \hline
        & $k_0$ & & $k_1$ & $k_2$ \\ \hline
      \end{array}
      $$
    }
\end{frame}

\begin{frame}\frametitle{Finding collision-free hash functions}
  \begin{itemize}
    \item Pick hash functions $h_i$ for every bin.
    \item Compute $o_i + h_i(k)$ for every $k$.
    \item Compute a histogram to count the number of collisions.
    \item Using a segmented scan, check if any subhash map has a collision.
    \item Partition subhash maps by if they had collision.
    \item Continue on subhash maps with collisions.
  \end{itemize}
\end{frame}


\begin{frame}\frametitle{Comparison}
  \begin{table}
    \begin{tabular}{|l|l|l|}
      \hline
      & FKS & Open Addressing \\ \hline
      Hashing & Universal Hash Family & Any\footnote{Technically not true.} \\ \hline
      Lookup & $O(1)$ & Expected $O(1)$ \\ \hline
      Construction & Expected $O(n)$ & $O(n)$ \\ \hline
      Dynamic & Yes\footnote{Seems impractical.} & Yes \\ \hline
    \end{tabular}
  \end{table}
\end{frame}

\begin{frame}\frametitle{Benchmarks}
  \only<1>{
    \begin{center}
      \begin{tabular}{l|rrr}
        & \multicolumn{3}{c}{\textbf{64-bit integer keys} ($n=10^{7}$)} \\
        & \textit{Construction} & \textit{Lookup} & \textit{Membership} \\\midrule
        Futhark (hash maps) & 18.3 & 3.3 & 1.6 \\
        Futhark (binary search) & 40.9 & 6.2 & 5.8 \\
        Futhark (Eytzinger) & 42.3 & 4.3 & 2.4 \\
        cuCollections & $2.7$ & $1.1$ & $0.9$ \\
      \end{tabular}
      \vspace{0.5cm}
      
      All times in milliseconds.
    \end{center}
  }
  \only<2>{
    \begin{center}
      \begin{tabular}{l|rrr}
        & \multicolumn{3}{c}{\textbf{String keys} ($n=10^{7}$)} \\
        & \textit{Construction} & \textit{Lookup} & \textit{Membership} \\\midrule
        Futhark (hash maps) & 33.2 & 4.3 & 2.8 \\
        Futhark (binary search) & 83.0 & 5.7 & 5.8 \\
        Futhark (Eytzinger) & 85.3 & 5.3 & 5.3 \\
        cuCollections & $2.7$ & $1.3$ & $1.2$ \\
      \end{tabular}
      \vspace{0.5cm}

      All times in milliseconds.
    \end{center}
  }
\end{frame}

\begin{frame}\frametitle{The End}
  \begin{center}
    \textbf{Towards Efficient Hash Maps in Functional Array Languages}\\
    \vspace{0.5cm}
    \url{https://arxiv.org/abs/2508.11443}

    \vspace{1cm}
    \textbf{Code} \\
    \vspace{0.5cm}
    \url{https://github.com/diku-dk/containers}
  \end{center}
\end{frame}

\end{document}
